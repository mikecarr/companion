<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:OpenIPC_Config.ViewModels"
             xmlns:models="clr-namespace:OpenIPC_Config.Models.Presets"
             xmlns:i="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:OpenIPC_Config.Views"
             xmlns:converters="clr-namespace:OpenIPC_Config.Converters"
             x:Class="OpenIPC_Config.Views.PresetsTabView"
             x:DataType="vm:PresetsTabViewModel">

    <UserControl.Resources>
        <!-- Converters -->
        <converters:CanConnectConverter x:Key="CanConnectConverter" />
        <converters:TagsToStringConverter x:Key="TagsToStringConverter" />

    </UserControl.Resources>

    <Grid RowDefinitions="Auto, Auto, Auto, *"
          ColumnDefinitions="*" Margin="10">
        <!-- Header with Information -->
        <Border Background="#B0B0B0" CornerRadius="10" Padding="10" Margin="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Path
                    Data="M10,20 A10,10 0 1,1 10,0 A10,10 0 1,1 10,20 Z M10,7 A1.5,1.5 0 1,0 10,4 A1.5,1.5 0 1,0 10,7 Z M9,8 L11,8 L11,14 L9,14 Z"
                    Fill="White"
                    Width="20"
                    Height="20"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Margin="5" />
                <TextBlock Grid.Column="1"
                           Text="Presets are predefined configuration sets for camera settings that can be downloaded from GitHub repositories, loaded locally, and applied to customize camera parameters with a single click, allowing users to quickly configure their camera with specific optimized settings."
                           Foreground="Black"
                           FontSize="14"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center"
                           Margin="10,0,0,0" />
            </Grid>
        </Border>

        <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10" Spacing="10">
            <!-- Search Box -->
            <TextBox Width="200"
                     Watermark="ðŸ”Search presets"
                     Text="{Binding SearchQuery, Mode=TwoWay}" />

            <!-- Fetch Button -->
            <Button Width="150" Height="30" Background="{StaticResource OpenIPCBlueBrush}"
                    VerticalAlignment="Center" CornerRadius="10"
                    IsEnabled="{Binding CanConnect}"
                    Command="{Binding FetchPresetsCommand}">

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center"
                            Spacing="5">

                    <!-- SVG Icon -->
                    <Svg Width="20" Height="20" Path="avares://OpenIPC_Config/Assets/Icons/iconoir_github.svg" />

                    <!-- Text -->
                    <TextBlock Text="Update" FontSize="14" Foreground="White" VerticalAlignment="Center" />
                </StackPanel>
            </Button>

            <!-- Add Button -->
            <!-- <Button Width="150" Height="30" Background="{StaticResource OpenIPCBlueBrush}" -->
            <!--         VerticalAlignment="Center" CornerRadius="10" -->
            <!--         IsEnabled="{Binding CanConnect}" -->
            <!--         Command="{Binding AddRepositoryCommand}"> -->
            <!-- -->
            <!--     <StackPanel Orientation="Horizontal" -->
            <!--                 HorizontalAlignment="Center" -->
            <!--                 VerticalAlignment="Center" Spacing="5"> -->
            <!-- -->
            <!-- -->
            <!--         ~1~ Text @1@ -->
            <!--         <TextBlock Text="Add Repository" FontSize="14" Foreground="White" VerticalAlignment="Center" /> -->
            <!--     </StackPanel> -->
            <!-- </Button> -->
            <!-- Save Preset Button -->
            <!-- <Button Width="150" Height="30" Background="{StaticResource OpenIPCBlueBrush}" -->
            <!--         VerticalAlignment="Center" CornerRadius="10" -->
            <!--         IsEnabled="{Binding CanConnect}" -->
            <!--         > -->
            <!-- -->
            <!--     <StackPanel Orientation="Horizontal" -->
            <!--                 HorizontalAlignment="Center" -->
            <!--                 VerticalAlignment="Center" Spacing="5"> -->
            <!-- -->
            <!--         ~1~ Text @1@ -->
            <!--         <TextBlock Text="Save Current" FontSize="14" Foreground="White" VerticalAlignment="Center" /> -->
            <!--     </StackPanel> -->
            <!-- </Button> -->
        </StackPanel>

        <!-- Filter Bar -->
        <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,10">
            <!-- Categories Dropdown -->
            <ComboBox Width="165"
                      ItemsSource="{Binding Categories}"
                      SelectedItem="{Binding SelectedCategory}"
                      PlaceholderText="Select Category" />

            <!-- Tags Dropdown -->
            <ComboBox Width="150"
                      ItemsSource="{Binding Tags}"
                      SelectedItem="{Binding SelectedTag}"
                      PlaceholderText="Select Tag" />

            <!-- Authors Dropdown -->
            <ComboBox Width="150"
                      ItemsSource="{Binding Authors}"
                      SelectedItem="{Binding SelectedAuthor}"
                      PlaceholderText="Select Author" />

            <!-- Status Dropdown -->
            <ComboBox Width="150"
                      ItemsSource="{Binding StatusOptions}"
                      SelectedItem="{Binding SelectedStatus}"
                      PlaceholderText="Select Status" />

            <!-- Clear Filters Button -->
            <Button Content="Clear Filters" Command="{Binding ClearFiltersCommand}" />
        </StackPanel>

        <!-- Presets List -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ItemsControl ItemsSource="{Binding Presets}"
                          IsEnabled="{Binding CanConnect}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:Preset">
                        <!-- Fixed size border with absolute positioning -->
                        <Border Width="350" Height="180" Background="#4169E1" CornerRadius="10" Margin="10,10">
                            <!-- Use a Grid with exact row heights to ensure consistent layout -->
                            <Grid RowDefinitions="Auto,*,Auto">
                                <!-- Card content area -->
                                <Grid Grid.Row="0" Margin="15,15,15,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="25" /> <!-- Title row -->
                                        <RowDefinition Height="40" /> <!-- Description row -->
                                    </Grid.RowDefinitions>

                                    <!-- Title with star -->
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding Name}"
                                                   FontWeight="Bold" FontSize="16"
                                                   Foreground="White"
                                                   TextTrimming="CharacterEllipsis" />

                                        <!-- Gold Star for Official status -->
                                        <Path Grid.Column="1" Width="20" Height="20" Margin="5,0,0,0"
                                              Fill="Gold"
                                              Data="M9,2 L7.1,7.3 L1.5,7.5 L6,11.1 L4.4,16.7 L9,14 L13.6,16.7 L12,11.1 L16.5,7.5 L10.9,7.3 Z"
                                              IsVisible="{Binding Status, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Official'}" />
                                    </Grid>

                                    <!-- Description -->
                                    <TextBlock Grid.Row="1" Text="{Binding Description}"
                                               FontSize="12" TextWrapping="Wrap"
                                               Foreground="White"
                                               TextTrimming="CharacterEllipsis" />
                                </Grid>

                                <!-- Metadata area with fixed position -->
                                <Grid Grid.Row="1" Margin="15,0,15,15">
                                    <StackPanel VerticalAlignment="Bottom">
                                        <!-- Category -->
                                        <Grid Height="20">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Category: "
                                                       FontWeight="Bold" Foreground="White" />
                                            <TextBlock Grid.Column="1" Text="{Binding Category}"
                                                       Foreground="White" TextTrimming="CharacterEllipsis" />
                                        </Grid>

                                        <!-- Author -->
                                        <Grid Height="20">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Author: "
                                                       FontWeight="Bold" Foreground="White" />
                                            <TextBlock Grid.Column="1" Text="{Binding Author}"
                                                       Foreground="White" TextTrimming="CharacterEllipsis" />
                                        </Grid>

                                        <!-- Status -->
                                        <Grid Height="20">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Status: "
                                                       FontWeight="Bold" Foreground="White" />
                                            <TextBlock Grid.Column="1" Text="{Binding Status}"
                                                       Foreground="White" TextTrimming="CharacterEllipsis" />
                                        </Grid>
                                    </StackPanel>
                                </Grid>

                                <!-- Button container with fixed position -->
                                <Grid Grid.Row="2" Height="50">
                                    <!-- Apply button with exact positioning -->
                                    <Button Content="Apply"
                                            Width="80"
                                            Height="35"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            HorizontalContentAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            Background="White"
                                            Foreground="#4169E1"
                                            CornerRadius="10"
                                            CommandParameter="{Binding}"
                                            Click="OnApplyPresetClicked"
                                            Margin="0,0,15,0" />
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

    </Grid>
</UserControl>